{"mappings":"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","sources":["dashboard/views-src/js/scheduled-tasks.js"],"sourcesContent":["import $ from 'jquery';\nimport dt from 'datatables.net-dt';\nimport * as dayjs from 'dayjs';\nimport advancedFormat from 'dayjs/plugin/advancedFormat';\ndayjs.extend(advancedFormat);\nconst utc = require('dayjs/plugin/utc');\nconst timezone = require('dayjs/plugin/timezone'); // dependent on utc plugin\ndayjs.extend(utc)\ndayjs.extend(timezone)\ndt();\nimport 'datatables.net-dt/css/jquery.dataTables.css';\n\nconst queryString = window.location.search;\nconst urlParams = new URLSearchParams(queryString);\nconst refreshInterval = urlParams.get('refreshInterval') || 30000\nif (urlParams.get('refresh')) {\n  window.setTimeout(function () {\n    window.location.reload();\n  }, parseInt(refreshInterval) * 1000);\n}\n\nlet cronTasksTable;\n\nloadTable();\n\nfunction loadTable () {\n  cronTasksTable = $('#tblCronTasks').DataTable({\n    // data: data,\n    ajax: './api/scheduled-tasks',\n    columns: [\n      {title: 'uuid', uuid: 'uuid', data: 'uuid',\n        render: colorTaskId\n      },\n      {title: 'Worker', data: 'worker', defaultContent: ''},\n      {title: 'Task Id', data: 'data.id', defaultContent: ''},\n      {\n        title: \"Task Data\",\n        \"className\": 'details-control',\n        \"orderable\": false,\n        \"data\": null,\n        \"defaultContent\": '<input type=\"button\" class=\"btn btn-task-data\" value=\"Task Data\">'\n      },\n      {title: 'Created', defaultContent: '',\n        data: function (rec) {\n          return rec.status.created || rec.created\n        },\n        render: formatDate\n      },\n      {title: 'Schedule', data: 'when', defaultContent: '', render: formatWhen},\n      {title: 'Stopped/Activated',\n        data: function (rec) {\n          return Math.max(rec.status.restarted || 0, rec.status.stopped || 0) || '-'\n        },\n        defaultContent: '-', render: formatDate},\n      {title: 'Message',\n        data: function (rec) {\n          return rec.message || (rec.error && rec.error.message) || rec.error || '-'\n        },\n        defaultContent: '-'\n      },\n      {\n        title: 'Actions',\n        \"className\":      'details-control',\n        \"orderable\":      false,\n        \"data\":           null,\n        render: function (data, type, row) {\n          const stts = data.status;\n          if (stts.completed || stts.failed || stts.abandoned) return '-';\n          return data.isActive ? '<input class=\"btn btn-stop\" type=\"button\" value=\"Stop\">'\n            : '<input class=\"btn btn-activate\" type=\"button\" value=\"Activate\">';\n        }\n      }\n    ],\n    order: [[ 4, \"desc\" ]],\n    columnDefs:[{\n      targets: '_all',\n      createdCell: formatStatus\n    }]\n  })\n\n  $('#tblCronTasks tbody').on('click', '.btn-task-data', function () {\n    console.log('show task data');\n    var tr = $(this).closest('tr');\n    var row = cronTasksTable.row( tr );\n    var btn = this;\n      // var btn = $(this).find('input')\n      if ( row.child.isShown() ) {\n        // This row is already open - close it\n        row.child.hide();\n        tr.removeClass('shown');\n        $(btn).val('Task Data')\n      }\n      else {\n        // Open this row\n        //row.child( format(row.data()) ).show();\n        const task = row.data();\n        row.child('<pre> ' + JSON.stringify(task.data || 'No data', null, 4) + '</pre>').show();\n        tr.addClass('shown');\n        $(btn).val('Less')\n      }\n  });\n\n  $('#tblCronTasks tbody').on('click', '.btn-result', function () {\n    var tr = $(this).closest('tr');\n    var row = cronTasksTable.row( tr );\n    var btn = this;\n      // var btn = $(this).find('input')\n      if ( row.child.isShown() ) {\n        // This row is already open - close it\n        row.child.hide();\n        tr.removeClass('shown');\n        $(btn).val('Result')\n      }\n      else {\n        // Open this row\n        //row.child( format(row.data()) ).show();\n        const data = row.data();\n        row.child('<pre> ' + JSON.stringify(data || 'No result', null, 4) + '</pre>').show();\n        tr.addClass('shown');\n        $(btn).val('Less')\n      }\n  });\n\n  $('#tblCronTasks tbody').on('click', '.btn-stop', function () {\n    var tr = $(this).closest('tr');\n    var row = cronTasksTable.row( tr );\n    stopTask(row.data());\n  });\n\n  $('#tblCronTasks tbody').on('click', '.btn-activate', function () {\n    var tr = $(this).closest('tr');\n    var row = cronTasksTable.row( tr );\n    restartTask(row.data());\n  });\n}\n\n// render function to format date\nfunction formatDate (data, type, row) {\n  if (data === '-') return data\n  return data ? dayjs.tz(data, 'Asia/Kolkata').format('YYYY-MM-DD kk:mm:ss') : ''\n}\n\nfunction formatWhen (data, type, row) {\n  if (typeof data === 'string') return data;\n  else return formatDate (data);\n}\n\nfunction colorTaskId (data, type, row) {\n  let color\n  if (row.status.stopped) {\n    color = 'orange'\n  } else if (row.status.completed) {\n    color = '#03a652'\n  } else {\n    color = '#524E4F'\n  }\n  if (color) return `<span style=\"color:${color};font-weight:bold;\">${data}</span>`\n  else return data\n}\n\n// createCell functions\nfunction formatStatus (td, data, rowData, row, col) {\n  if (data === 'done') $(td).css('color', 'green')\n  if (data === 'error') $(td).css('color', 'red')\n  if (data === 'running') $(td).css('color', 'orange')\n}\n\n// stop the running task\nfunction stopTask(rowData) {\n  $.ajax({\n    method: 'PUT',\n    url: `./api/task/stop/${rowData.uuid}`,\n    cache: false\n  })\n  .done(function(data) {\n    cronTasksTable.ajax.reload(null, false);\n  })\n  .fail(function (resp) {\n    console.error('Error: ', resp.message);\n  })\n}\n\n// stop the running task\nfunction restartTask(rowData) {\n  $.ajax({\n    method: 'PUT',\n    url: `./api/task/restart/${rowData.uuid}`,\n    cache: false\n  })\n  .done(function(data) {\n    cronTasksTable.ajax.reload(null, false);\n  })\n  .fail(function (resp) {\n    console.error('Error: ', resp.message);\n  })\n}\n"],"names":["$6KOho","parcelRequire","$gngdn","extend","$parcel$interopDefault","$f6zku","$gogTx","$dLCGn","$kYsr5","$352603671c32430b$var$queryString","window","location","search","$352603671c32430b$var$urlParams","URLSearchParams","$352603671c32430b$var$refreshInterval","get","$352603671c32430b$var$cronTasksTable","$352603671c32430b$var$formatDate","data","type","row","tz","format","$352603671c32430b$var$formatWhen","$352603671c32430b$var$colorTaskId","color","status","stopped","completed","$352603671c32430b$var$formatStatus","td","rowData","col","css","setTimeout","reload","parseInt","DataTable","ajax","columns","title","uuid","render","defaultContent","className","orderable","rec","created","Math","max","restarted","message","error","stts","failed","abandoned","isActive","order","columnDefs","targets","createdCell","on","console","log","tr","this","closest","child","isShown","hide","removeClass","val","task","JSON","stringify","show","addClass","method","url","cache","done","fail","resp"],"version":3,"file":"scheduled-tasks.933810e2.js.map"}