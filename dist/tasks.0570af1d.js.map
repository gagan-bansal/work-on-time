{"mappings":"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","sources":["dashboard/views-src/js/tasks.js"],"sourcesContent":["import $ from 'jquery';\nimport dt from 'datatables.net-dt';\nimport * as dayjs from 'dayjs';\nimport advancedFormat from 'dayjs/plugin/advancedFormat';\ndayjs.extend(advancedFormat);\nconst utc = require('dayjs/plugin/utc');\nconst timezone = require('dayjs/plugin/timezone'); // dependent on utc plugin\ndayjs.extend(utc)\ndayjs.extend(timezone)\ndt();\nimport 'datatables.net-dt/css/jquery.dataTables.css';\n\nconst queryString = window.location.search;\nconst urlParams = new URLSearchParams(queryString);\nconst refreshInterval = urlParams.get('refreshInterval') || 30000\nif (urlParams.get('refresh')) {\n  window.setTimeout(function () {\n    window.location.reload();\n  }, parseInt(refreshInterval) * 1000);\n}\n\nlet tasksTable;\n\nloadTable();\n\nfunction loadTable () {\n  tasksTable = $('#tblTasks').DataTable({\n    // data: data,\n    ajax: './api/tasks',\n    columns: [\n      {title: 'uuid', uuid: 'uuid', data: 'uuid',\n        render: colorJobId\n      },\n      {title: 'Job', data: 'job', defaultContent: ''},\n      {title: 'Job Id', data: 'data.id', defaultContent: ''},\n      {\n        title: \"Task Data\",\n        \"className\": 'details-control',\n        \"orderable\": false,\n        \"data\": null,\n        \"defaultContent\": '<input type=\"button\" class=\"btn btn-task-data\" value=\"Task Data\">'\n      },\n      {title: 'Created', defaultContent: '',\n        data: function (rec) {\n          return rec.status.created || rec.created\n        },\n        render: formatDate\n      },\n      {title: 'Added To Queue', data: 'status.addedToQueue', defaultContent: '', render: formatDate, visible: false},\n      {title: 'Started', data: 'status.started', defaultContent: '', render: formatDate},\n      {title: 'Stopped', data: 'status.stopped', defaultContent: '-', render: formatDate},\n      {title: 'Failed', data: 'status.failed', defaultContent: '-', render: formatDate},\n      {title: 'Message',\n        data: function (rec) {\n          return rec.message || (rec.error && rec.error.message) || rec.error || '-'\n        },\n        defaultContent: '-'\n      },\n      {title: 'Completed', data: 'status.completed', defaultContent: '-', render: formatDate},\n      {\n        title: \"Task Result\",\n        \"className\": 'details-control',\n        \"orderable\": false,\n        \"data\": null,\n        //\"defaultContent\": '<input type=\"button\" class=\"btn btn-result\" value=\"Result\">'\n        render: function (data, type, row) {\n          const isDone = data.status.completed || data.status.failed || data.status.stopped;\n          return isDone ? '<input type=\"button\" class=\"btn btn-result\" value=\"Result\">' : '-';\n        }\n      },\n      {\n        title: 'Actions',\n        \"className\":      'details-control',\n        \"orderable\":      false,\n        \"data\":           null,\n        // \"defaultContent\": '<input class=\"btn btn-stop\" type=\"button\" value=\"Stop\">'\n        render: function (data, type, row) {\n          const isRunning = data.status.started &&\n            !data.status.completed  && !data.status.failed && !data.status.stopped;\n          return isRunning ? '<input class=\"btn btn-stop\" type=\"button\" value=\"Stop\">' : '-';\n        }\n      }\n    ],\n    order: [[ 4, \"desc\" ]],\n    columnDefs:[{\n      targets: '_all',\n      createdCell: formatStatus\n    }]\n  })\n\n  $('#tblTasks tbody').on('click', '.btn-task-data', function () {\n    var tr = $(this).closest('tr');\n    var row = tasksTable.row( tr );\n    var btn = this;\n      // var btn = $(this).find('input')\n      if ( row.child.isShown() ) {\n        // This row is already open - close it\n        row.child.hide();\n        tr.removeClass('shown');\n        $(btn).val('Task Data')\n      }\n      else {\n        // Open this row\n        //row.child( format(row.data()) ).show();\n        const data = row.data();\n        row.child('<pre> ' + JSON.stringify(data.data || 'No data', null, 4) + '</pre>').show();\n        tr.addClass('shown');\n        $(btn).val('Less')\n      }\n  });\n\n  $('#tblTasks tbody').on('click', '.btn-result', function () {\n    var tr = $(this).closest('tr');\n    var row = tasksTable.row( tr );\n    var btn = this;\n      // var btn = $(this).find('input')\n      if ( row.child.isShown() ) {\n        // This row is already open - close it\n        row.child.hide();\n        tr.removeClass('shown');\n        $(btn).val('Result')\n      }\n      else {\n        // Open this row\n        //row.child( format(row.data()) ).show();\n        const data = row.data();\n        row.child('<pre> ' + JSON.stringify(data || 'No result', null, 4) + '</pre>').show();\n        tr.addClass('shown');\n        $(btn).val('Less')\n      }\n  });\n\n  $('#tblTasks tbody').on('click', '.btn-stop', function () {\n    var tr = $(this).closest('tr');\n    var row = tasksTable.row( tr );\n    stopTask(row.data());\n  });\n}\n\n// render function to format date\nfunction formatDate (data, type, row) {\n  if (data === '-') return data\n  return data ? dayjs.tz(data, 'Asia/Kolkata').format('YYYY-MM-DD kk:mm:ss') : ''\n}\n\nfunction colorJobId (data, type, row) {\n  let color\n  if (row.status.completed) color = '#03a652'\n  else if (row.status.failed || row.status.stopped) color = 'red'\n  else if (row.status.started) color = '#444da3'\n  else if (row.status.addedToQueue) color = '#fdaf16'\n  if (color) return `<span style=\"color:${color};font-weight:bold;\">${data}</span>`\n  else return data\n}\n\n// createCell functions\nfunction formatStatus (td, data, rowData, row, col) {\n  if (data === 'done') $(td).css('color', 'green')\n  if (data === 'error') $(td).css('color', 'red')\n  if (data === 'running') $(td).css('color', 'orange')\n}\n\n// stop the running task\nfunction stopTask(rowData) {\n  $.ajax({\n    method: 'PUT',\n    url: `./api/task/stop/${rowData.uuid}`,\n    cache: false\n  })\n  .done(function(data) {\n    tasksTable.ajax.reload(null, false);\n  })\n  .fail(function (resp) {\n    console.error('Error: ', resp.message);\n  })\n}\n"],"names":["$6KOho","parcelRequire","$gngdn","extend","$parcel$interopDefault","$f6zku","$gogTx","$dLCGn","$kYsr5","$f641c33feab385cf$var$queryString","window","location","search","$f641c33feab385cf$var$urlParams","URLSearchParams","$f641c33feab385cf$var$refreshInterval","get","$f641c33feab385cf$var$tasksTable","$f641c33feab385cf$var$formatDate","data","type","row","tz","format","$f641c33feab385cf$var$colorJobId","color","status","completed","failed","stopped","started","addedToQueue","$f641c33feab385cf$var$formatStatus","td","rowData","col","css","setTimeout","reload","parseInt","DataTable","ajax","columns","title","uuid","render","defaultContent","className","orderable","rec","created","visible","message","error","order","columnDefs","targets","createdCell","on","tr","this","closest","child","isShown","hide","removeClass","val","JSON","stringify","show","addClass","method","url","cache","done","fail","resp","console"],"version":3,"file":"tasks.0570af1d.js.map"}